<div ng-controller="OfferCtrl as vm">
  <div class="col-md-12" style="margin-top: 30px; margin-bottom: 20px;">
    <div class="col-md-2">
      <select class="form-control"
          ng-model="vm.clientTypes.selected"
          ng-options="option.name for option in vm.clientTypes.availableOptions track by option.id"
          ng-change="vm.filterClientType()">
      </select>
    </div>

    <div class="col-md-12">
      <div class="col-md-4 form-padding">
        <fieldset ng-hide="vm.clientTypes.selected.id != 0">
          <h3>Физическо Лице</h3>

          <label for="input-01">ID</label>
          <input type="text" id="input-01" class="form-control text-margin" placeholder="" ng-model="vm.applicationInfo.id">

          <label for="input-02">Име</label>
          <input type="text" id="input-02" class="form-control text-margin" placeholder=""  ng-model="vm.applicationInfo.firstName">

          <label for="input-03">Фамилия</label>
          <input type="text" id="input-03" class="form-control text-margin" placeholder=""  ng-model="vm.applicationInfo.lastName">

          <label for="input-03">ЕГН</label>
          <input type="text" id="input-03" class="form-control text-margin" placeholder=""  ng-model="vm.applicationInfo.egn">
        </fieldset>

        <fieldset ng-hide="vm.clientTypes.selected.id == 0">
          <h3>Юридическо Лице</h3>

          <label for="input-01">ID</label>
          <input type="text" id="input-01" class="form-control text-margin" placeholder="" ng-model="vm.applicationInfo.id">

          <label for="input-02">Име на Фирма</label>
          <input type="text" id="input-02" class="form-control text-margin" placeholder="" ng-model="vm.applicationInfo.company">

          <label for="input-03">ЕИК</label>
          <input type="text" id="input-03" class="form-control text-margin" placeholder="" ng-model="vm.applicationInfo.eik">

          <label for="input-04">ДДС</label>
          <input type="text" id="input-04" class="form-control text-margin" placeholder="" ng-model="vm.applicationInfo.dds">
        </fieldset>
      </div>

      <div class="col-md-4 form-padding">
        <h3>Оферта</h3>

        <label for="input-05">Дата на кредит</label>
        <input type="text" id="input-05" class="form-control text-margin" placeholder="" ng-model="vm.applicationInfo.dateAdded">

        <label for="input-06">Регион</label>
        <input type="text" id="input-06" class="form-control text-margin" placeholder="" ng-model="vm.applicationInfo.region">

        <label for="input-07">Филиал</label>
        <input type="text" id="input-07" class="form-control text-margin" placeholder="" ng-model="vm.applicationInfo.branch">
      </div>

      <div class="col-md-4 form-padding">
        <h3>Оператор</h3>

        <label for="input-08">ID</label>
        <input type="text" id="input-08" class="form-control text-margin" value="{{ vm.operator.id }}" disabled>

        <label for="input-09">Име и Фамилия</label>
        <input type="text" id="input-09" class="form-control text-margin" value="{{ vm.operator.name }}" disabled>

        <label for="input-10">Телефон</label>
        <input type="text" id="input-10" class="form-control text-margin" value="{{ vm.operator.phone }}" disabled>
      </div>
    </div>
  </div>

  <h1>Оферта</h1>

  <!-- OFFER FORM -->
  <form novalidate id="offerForm" name="offerForm" style="width:70%" class="form-horizontal" ng-submit="vm.makeOffer()">

    <!-- LOAN TYPE -->
    <div class="form-group">
      <label class="control-label col-xs-2" for="loanType">Лихвен модел:</label>
      <div class="col-xs-5">
        <select name="loanType" class="form-control" id="loanType" ng-selected="1"  ng-model="vm.applicationInfo.offerType" >
          <option>{{ vm.offerModels[0] }}</option>
          <option>{{ vm.offerModels[1] }}</option>
        </select>
      </div>
    </div>

    <!-- LOAN -->
    <div class="form-group">
        <label class="control-label col-xs-2" for="loan">Заем:</label>
          <div class="col-xs-5">
            <input class="form-control" id="loan" name="loan" placeholder="Заем" type="text"
             ng-model="vm.loan" maxlength="15" required >
          </div>
          <span ng-if="vm.loan && !vm.validateTotalSum(vm.loan)"
          class="validation-error">Невалиден заем!</span>
    </div>

    <!-- INTEREST % -->
    <div class="form-group">
      <label class="control-label col-xs-2" for="interest">Лихва %:</label>
        <div class="col-xs-5">
          <input class="form-control" id="interest" ng-model="vm.interest" placeholder="Лихва"
           type="text" ng-minlength=1 maxlength="6" required>
        </div>
        <span ng-if="vm.interest && !vm.validateTotalSum(vm.interest)"
        class="validation-error">Невалидна лихва!</span>
    </div>

    <!-- NUMBER OF PAYMENTS PER YEAR -->
    <div class="form-group">
      <label class="control-label col-xs-2" for="paymentPerMonth">Брой вноски на година:</label>
        <div class="col-xs-5">
          <input class="form-control" id="payment-per-month" ng-model="vm.numpayments"
           placeholder="Брой вноски на година" type="text" ng-minlength=1 maxlength="2" required>
        </div>
        <span ng-if="vm.numpayments && !vm.validatePositiveInteger(vm.numpayments)"
        class="validation-error">Въведи между 1 и 12 дена!</span>
    </div>

    <!-- YEARS -->
    <div class="form-group">
      <label class="control-label col-xs-2" for="years">Години:</label>
        <div class="col-xs-5">
          <input class="form-control" id="years" ng-model="vm.years" placeholder="Години"
           type="text" maxlength="3" required>
        </div>
        <span ng-if="vm.years && !vm.validatePositiveInteger(vm.years)"
        class="validation-error">Невалиден брой години!</span>
    </div>

    <!-- CURRENCY -->
    <div class="form-group">
      <label class="control-label col-xs-2" for="currency">Валута:</label>
      <div class="col-xs-5">
        <select class="form-control" id="currency" ng-model="vm.selectedCurrency.name"
         ng-options="c.code as c.name for c in vm.currencies" >
        </select>
      </div>
    </div>

    <!-- BUTTON -->
    <div class="form-group">
      <div class="col-xs-10">
        <button class="btn btn-primary" data-ng-disabled="!vm.validateForm()"
         type="submit" ng-click="vm.showData()">Изчисли Оферта</button>
      </div>
    </div>

  </form>

  <!-- DATA  -->
  <div id="dataField" class="ng-hide" style="width:70%">
    <hr>
    <div class="resultText">
      <b>Дължима сума</b>:</div>
    <span class="resultInfo" id="totalSum">
      <b>{{vm.offerTable[0].totalAmount | number:2}}
        {{vm.selectedCurrency.name}}</b>
    </span>
    <br style="clear:both">
    <div class="resultText">35 месечни вноски от:</div>
    <span class="resultInfo" id="monthlyPayment">{{vm.offerTable[0].payment | number:2}}
      {{vm.selectedCurrency.name}}</span>
    <br style="clear:both">
    <div class="resultText">Цяла лихва:</div>
    <span class="resultInfo" id="totalInterest">{{vm.offerTable[0].totalInterest | number:2}}
      {{vm.selectedCurrency.name}}</span>
    <br style="clear:both">
    <div class="resultText">Сума на заема:</div>
    <span class="resultInfo" id="loanAmount">
      {{vm.offerTable[0].startBalance | number:2}}
      {{vm.selectedCurrency.name}}</span>
    <br style="clear:both">
    <div class="resultText">Лихвa %:</div>
    <span class="resultInfo" id="interestPercent">{{vm.interest}}%</span>
    <br style="clear:both">
    <!-- <div class="resultText">Ефективна годишна лихва:</div>
    <span class="resultInfo">12.68%</span> -->
    <hr>
    <div class="btn btn-success" id="create_pdf_up" role="button" ng-click="vm.printPDF()">Изтегли PDF</div>
    <hr>
    <!--TABLE  -->
    <table id="table" class="table table-striped table-bordered table-condensed">
      <thead>
        <th>Номер на вноска</th>
        <th>Сума на заема</th>
        <th>Главница на вноска</th>
        <th>Лихва на вноска</th>
        <th>Вноска</th>
      </thead>
      <tbody>
        <tr ng-repeat="data in vm.offerTable">
          <td>{{data.month}}</td>
          <td>{{data.startBalance | number:2}}</td>
          <td>{{data.principal | number:2}}</td>
          <td>{{data.interest | number:2}}</td>
          <td>{{data.payment | number:2}}</td>
        </tr>
      </tbody>
    </table>
    <div class="btn btn-success" role="button" ng-click="vm.addApplication()">Запиши</div>
    <div class="btn btn-success" id="create_pdf" role="button" ng-click="vm.printPDF()">Изтегли PDF</div>
    <hr>
  </div>
</div>
